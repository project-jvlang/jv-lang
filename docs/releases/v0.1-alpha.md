# v0.1 Alpha リリースノート

最終更新日: 2025-10-09

## ハイライト
- Kotlinスタイルのコレクション拡張関数群（`map`/`filter`/`flatMap`/`sorted`/`reduce`/`associate` など）を jv 標準ライブラリに導入し、暗黙 Sequence パイプラインをサポートしました。
- Java 25 をメインターゲット、Java 21 をフォールバックターゲットとして、`Stream` API と逐次 `for` ループを使い分けるコード生成を統合しました。
- CLI ヘルプと新規ドキュメントを整備し、Sequence↔Stream ブリッジやラムダ記法の制限事項を明記しました。

## KotlinスタイルコレクションAPI
- `Iterable` や空白区切り配列に対する変換操作は `asSequence()` なしで遅延 Sequence として解釈され、中間コレクションを生成しません。
- 終端操作（`toList`/`toSet`/`groupBy`/`associate`/`count`/`sum`/`forEach`）は Kotlin と同じ挙動で具現化し、`reduce` の空コレクションでは Kotlin 互換の `IllegalArgumentException` を送出します。
- ラムダ式は `{ value -> ... }` 形式で引数名を必須とし、タプル分解 `{ (acc, value) -> ... }` をサポートします。暗黙 `it` は使用できません。

## Java ターゲット互換性
- Java 25 ターゲットでは `.toList()`/`.toSet()`/`Stream::map` など最新 API を直接利用し、Java 21 ターゲットでは `Collectors` ベースのフォールバックを自動生成します。
- `AutoCloseable` ソースを含む Sequence チェーンでは `try-with-resources` を挿入し、リソースリークを防止します。
- `Stream` から変換した結果は終端後に再評価できないため、CLI ヘルプで再利用不可ポリシーを周知しています。

## ドキュメント & ツール更新
- `docs/stdlib/collections.md` を新設し、操作パリティ表・評価モデル・Stream ブリッジの制限事項を整理しました。
- `jv --help` のロングヘルプに Sequence パイプライン概要、Java 21 フォールバック、明示ラムダルールを追加しました。
- 今後のランタイム互換性検証に向けて `make test-lowmem-crate CRATE=jv_cli` を用いた省メモリ検証手順をガイドに追記しました。

## 既知の制約
- 大量要素の `sorted`/`sortedBy` は現在シングルスレッドで動作します。将来的にバルクソート最適化を検討しています。
- `Stream` ブリッジ後に再度遅延チェーンを構築する場合は、`toList()` で具現化した結果を再入力として利用してください。
